---
// src/pages/compras.astro
import AppLayout from '../layouts/AppLayout.astro';
---
<AppLayout title="Compras">
  <style>
    .page-header { margin-bottom: var(--space-8); }
    .page-header h2 { margin-bottom: var(--space-1); }
    .page-header p { color: var(--text-muted); margin: 0; }

    .list { border: 1px solid var(--border); border-radius: var(--radius-lg); overflow: hidden; }
    .row { display: flex; align-items: center; gap: var(--space-4); padding: var(--space-4); border-bottom: 1px solid var(--border); }
    .row:last-child { border-bottom: none; }
    .row:hover { background: var(--gray-50); }
    .info { flex: 1; }
    .info strong { display: block; font-size: var(--font-sm); }
    .info small { color: var(--text-muted); font-size: var(--font-xs); }
    .total { font-weight: 700; font-size: var(--font-base); }
    .empty { text-align: center; padding: var(--space-12); color: var(--text-muted); }
    .empty .icon { font-size: 2rem; display: block; margin-bottom: var(--space-3); }
    .loading { text-align: center; padding: var(--space-8); color: var(--text-muted); font-size: var(--font-sm); }
  </style>

  <div class="page-header">
    <h2>ðŸ›’ Compras</h2>
    <p>Historial de compras del hogar.</p>
  </div>

  <div class="list" id="list">
    <div class="loading">Cargandoâ€¦</div>
  </div>

  <script type="module">
    import { apiFetch } from '/src/lib/auth-client.js';

    const list = document.getElementById('list');
    const data = await apiFetch('/compras');

    if (!data?.success) {
      list.innerHTML = '<div class="loading">Error al cargar las compras.</div>';
    } else if (!data.data.length) {
      list.innerHTML = '<div class="empty"><span class="icon">ðŸ›’</span>AÃºn no registraste ninguna compra.</div>';
    } else {
      list.innerHTML = data.data.map(c => `
        <div class="row">
          <div class="info">
            <strong>${c.lugar_compra || 'Sin nombre'}</strong>
            <small>${new Date(c.fecha).toLocaleDateString('es-AR', { year:'numeric', month:'long', day:'numeric' })}</small>
          </div>
          <div class="total">$${(c.total || 0).toLocaleString('es-AR')}</div>
        </div>`).join('');
    }
  </script>
</AppLayout>
